import{S as e,i as t,s as i,e as s,t as r,j as n,c as o,a,b as h,d as c,l,f as d,g as u,h as p,n as f,E as m,Q as v,L as b,A as g,B as w,R as y,p as I,q as S,r as E,w as k,x as P,y as x,k as C,D as T,C as A}from"../chunks/index-bf7fb778.js";import{m as q,f as L,c as _,u as M}from"../chunks/store-5de4d08f.js";const D={waitForInputStart:0,pieceClickedThreshold:1,clickTo:2,secondClickThreshold:3,dragTo:4,clickDragTo:5,moveDone:6,reset:7},R="secondClick",O="movedOutOfBoard";class G{constructor(e,t,i,s,r,n){this.view=e,this.state=t,this.props=i,this.moveStartCallback=s,this.moveDoneCallback=r,this.moveCanceledCallback=n,this.setMoveInputState(D.waitForInputStart)}setMoveInputState(e,t){const i=this.moveInputState;switch(this.moveInputState=e,e){case D.waitForInputStart:break;case D.pieceClickedThreshold:if(D.waitForInputStart!==i)throw new Error("moveInputState");if(this.startIndex=t.index,this.endIndex=void 0,this.movedPiece=t.piece,this.updateStartEndMarkers(),this.startPoint=t.point,this.pointerMoveListener||this.pointerUpListener)throw Error("_pointerMoveListener or _pointerUpListener");if("mousedown"===t.type)this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="mousemove",window.addEventListener("mousemove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="mouseup",window.addEventListener("mouseup",this.pointerUpListener);else{if("touchstart"!==t.type)throw Error("event type");this.pointerMoveListener=this.onPointerMove.bind(this),this.pointerMoveListener.type="touchmove",window.addEventListener("touchmove",this.pointerMoveListener),this.pointerUpListener=this.onPointerUp.bind(this),this.pointerUpListener.type="touchend",window.addEventListener("touchend",this.pointerUpListener)}break;case D.clickTo:this.draggablePiece&&(F.removeElement(this.draggablePiece),this.draggablePiece=void 0),i===D.dragTo&&this.view.setPieceVisibility(t.index);break;case D.secondClickThreshold:if(D.clickTo!==i)throw new Error("moveInputState");this.startPoint=t.point;break;case D.dragTo:if(D.pieceClickedThreshold!==i)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled&&(this.view.setPieceVisibility(t.index,!1),this.createDraggablePiece(t.piece));break;case D.clickDragTo:if(D.secondClickThreshold!==i)throw new Error("moveInputState");this.view.chessboard.state.inputEnabled&&(this.view.setPieceVisibility(t.index,!1),this.createDraggablePiece(t.piece));break;case D.moveDone:if(-1===[D.dragTo,D.clickTo,D.clickDragTo].indexOf(i))throw new Error("moveInputState");if(this.endIndex=t.index,this.endIndex&&this.moveDoneCallback(this.startIndex,this.endIndex)){const e=this.state.squares.slice(0);this.state.setPiece(this.startIndex,void 0),this.state.setPiece(this.endIndex,this.movedPiece),i===D.clickTo?(this.updateStartEndMarkers(),this.view.animatePieces(e,this.state.squares.slice(0),(()=>{this.setMoveInputState(D.reset)}))):(this.view.drawPieces(this.state.squares),this.setMoveInputState(D.reset))}else this.view.drawPiecesDebounced(),this.setMoveInputState(D.reset);break;case D.reset:this.startIndex&&!this.endIndex&&this.movedPiece&&this.state.setPiece(this.startIndex,this.movedPiece),this.startIndex=void 0,this.endIndex=void 0,this.movedPiece=void 0,this.updateStartEndMarkers(),this.draggablePiece&&(F.removeElement(this.draggablePiece),this.draggablePiece=void 0),this.pointerMoveListener&&(window.removeEventListener(this.pointerMoveListener.type,this.pointerMoveListener),this.pointerMoveListener=void 0),this.pointerUpListener&&(window.removeEventListener(this.pointerUpListener.type,this.pointerUpListener),this.pointerUpListener=void 0),this.setMoveInputState(D.waitForInputStart);break;default:throw Error(`moveInputState ${e}`)}}createDraggablePiece(e){if(this.draggablePiece)throw Error("draggablePiece exists");this.draggablePiece=F.createSvg(document.body),this.draggablePiece.classList.add("cm-chessboard-draggable-piece"),this.draggablePiece.setAttribute("width",this.view.squareWidth),this.draggablePiece.setAttribute("height",this.view.squareHeight),this.draggablePiece.setAttribute("style","pointer-events: none"),this.draggablePiece.name=e;const t=this.props.sprite.cache?"":this.props.sprite.url,i=F.addElement(this.draggablePiece,"use",{href:`${t}#${e}`}),s=this.view.squareHeight/this.props.sprite.size,r=this.draggablePiece.createSVGTransform();r.setScale(s,s),i.transform.baseVal.appendItem(r)}moveDraggablePiece(e,t){this.draggablePiece.setAttribute("style",`pointer-events: none; position: absolute; left: ${e-this.view.squareHeight/2}px; top: ${t-this.view.squareHeight/2}px`)}onPointerDown(e){if("mousedown"===e.type&&0===e.button||"touchstart"===e.type){const t=e.target.getAttribute("data-index"),i=this.view.getPiece(t);let s,r;if(i&&(s=i.getAttribute("data-piece"),r=s?s.substr(0,1):void 0,("w"===r&&this.state.inputWhiteEnabled||"b"===r&&this.state.inputBlackEnabled)&&e.preventDefault()),void 0!==t&&(this.moveInputState!==D.waitForInputStart||this.state.inputWhiteEnabled&&"w"===r||this.state.inputBlackEnabled&&"b"===r)){let i;"mousedown"===e.type?i={x:e.clientX,y:e.clientY}:"touchstart"===e.type&&(i={x:e.touches[0].clientX,y:e.touches[0].clientY}),this.moveInputState===D.waitForInputStart&&s&&this.moveStartCallback(t)?this.setMoveInputState(D.pieceClickedThreshold,{index:t,piece:s,point:i,type:e.type}):this.moveInputState===D.clickTo&&(t===this.startIndex?this.setMoveInputState(D.secondClickThreshold,{index:t,piece:s,point:i,type:e.type}):this.setMoveInputState(D.moveDone,{index:t}))}}}onPointerMove(e){let t,i,s,r,n;if("mousemove"===e.type?(s=e.clientX,r=e.clientY,t=e.pageX,i=e.pageY,n=e.target):"touchmove"===e.type&&(s=e.touches[0].clientX,r=e.touches[0].clientY,t=e.touches[0].pageX,i=e.touches[0].pageY,n=document.elementFromPoint(s,r)),this.moveInputState===D.pieceClickedThreshold||this.moveInputState===D.secondClickThreshold)(Math.abs(this.startPoint.x-s)>4||Math.abs(this.startPoint.y-r)>4)&&(this.moveInputState===D.secondClickThreshold?this.setMoveInputState(D.clickDragTo,{index:this.startIndex,piece:this.movedPiece}):this.setMoveInputState(D.dragTo,{index:this.startIndex,piece:this.movedPiece}),this.view.chessboard.state.inputEnabled&&this.moveDraggablePiece(t,i));else if(this.moveInputState===D.dragTo||this.moveInputState===D.clickDragTo||this.moveInputState===D.clickTo){if(n&&n.getAttribute&&n.parentElement===this.view.boardGroup){const e=n.getAttribute("data-index");e!==this.startIndex&&e!==this.endIndex?(this.endIndex=e,this.updateStartEndMarkers()):e===this.startIndex&&void 0!==this.endIndex&&(this.endIndex=void 0,this.updateStartEndMarkers())}else void 0!==this.endIndex&&(this.endIndex=void 0,this.updateStartEndMarkers());!this.view.chessboard.state.inputEnabled||this.moveInputState!==D.dragTo&&this.moveInputState!==D.clickDragTo||this.moveDraggablePiece(t,i)}}onPointerUp(e){let t;if("mouseup"===e.type?t=e.target:"touchend"===e.type&&(t=document.elementFromPoint(e.changedTouches[0].clientX,e.changedTouches[0].clientY)),t&&t.getAttribute){const e=t.getAttribute("data-index");e?this.moveInputState===D.dragTo||this.moveInputState===D.clickDragTo?this.startIndex===e?this.moveInputState===D.clickDragTo?(this.state.setPiece(this.startIndex,this.movedPiece),this.view.setPieceVisibility(this.startIndex),this.setMoveInputState(D.reset)):this.setMoveInputState(D.clickTo,{index:e}):this.setMoveInputState(D.moveDone,{index:e}):this.moveInputState===D.pieceClickedThreshold?this.setMoveInputState(D.clickTo,{index:e}):this.moveInputState===D.secondClickThreshold&&(this.setMoveInputState(D.reset),this.moveCanceledCallback(R,e)):(this.view.drawPiecesDebounced(),this.setMoveInputState(D.reset),this.moveCanceledCallback(O,void 0))}else this.view.drawPiecesDebounced(),this.setMoveInputState(D.reset)}updateStartEndMarkers(){this.state.removeMarkers(void 0,J.move),this.startIndex&&this.state.addMarker(this.startIndex,J.move),this.endIndex&&this.state.addMarker(this.endIndex,J.move),this.view.drawMarkersDebounced()}reset(){this.setMoveInputState(D.reset)}destroy(){this.reset()}}const $=0,N=1,U=2;function z(){}class Q{constructor(e,t,i,s,r){if(this.view=e,this.view.animationRunning)throw new z;t&&i&&(this.animatedElements=this.createAnimation(t,i),this.duration=s,this.callback=r,this.view.animationRunning=!0,this.frameHandle=requestAnimationFrame(this.animationStep.bind(this)))}seekChanges(e,t){const i=[],s=[],r=[];for(let n=0;n<64;n++){const r=e[n],o=t[n];o!==r&&(o&&i.push({piece:o,index:n}),r&&s.push({piece:r,index:n}))}return i.forEach((e=>{let t,i=8;s.forEach((s=>{if(e.piece===s.piece){const r=this.squareDistance(e.index,s.index);r<i&&(t=s,i=r)}})),t?(s.splice(s.indexOf(t),1),r.push({type:$,piece:e.piece,atIndex:t.index,toIndex:e.index})):r.push({type:N,piece:e.piece,atIndex:e.index})})),s.forEach((e=>{r.push({type:U,piece:e.piece,atIndex:e.index})})),r}createAnimation(e,t){const i=this.seekChanges(e,t),s=[];return i.forEach((e=>{const t={type:e.type};switch(e.type){case $:t.element=this.view.getPiece(e.atIndex),t.atPoint=this.view.squareIndexToPoint(e.atIndex),t.toPoint=this.view.squareIndexToPoint(e.toIndex);break;case N:t.element=this.view.drawPiece(e.atIndex,e.piece),t.element.style.opacity=0;break;case U:t.element=this.view.getPiece(e.atIndex)}s.push(t)})),s}animationStep(e){this.startTime||(this.startTime=e);const t=e-this.startTime;t<=this.duration?this.frameHandle=requestAnimationFrame(this.animationStep.bind(this)):(cancelAnimationFrame(this.frameHandle),this.view.animationRunning=!1,this.callback());const i=Math.min(1,t/this.duration),s=i<.5?2*i*i:(4-2*i)*i-1;this.animatedElements.forEach((e=>{if(e.element)switch(e.type){case $:e.element.transform.baseVal.removeItem(0);const t=this.view.svg.createSVGTransform();t.setTranslate(e.atPoint.x+(e.toPoint.x-e.atPoint.x)*s,e.atPoint.y+(e.toPoint.y-e.atPoint.y)*s),e.element.transform.baseVal.appendItem(t);break;case N:e.element.style.opacity=s;break;case U:e.element.style.opacity=1-s}else console.warn("animatedItem has no element",e)}))}squareDistance(e,t){const i=e%8,s=Math.floor(e/8),r=t%8,n=Math.floor(t/8);return Math.max(Math.abs(n-s),Math.abs(r-i))}}const j=["a1","b1","c1","d1","e1","f1","g1","h1","a2","b2","c2","d2","e2","f2","g2","h2","a3","b3","c3","d3","e3","f3","g3","h3","a4","b4","c4","d4","e4","f4","g4","h4","a5","b5","c5","d5","e5","f5","g5","h5","a6","b6","c6","d6","e6","f6","g6","h6","a7","b7","c7","d7","e7","f7","g7","h7","a8","b8","c8","d8","e8","f8","g8","h8"];class B{constructor(e,t){this.animationRunning=!1,this.currentAnimation=void 0,this.chessboard=e,this.moveInput=new G(this,e.state,e.props,this.moveStartCallback.bind(this),this.moveDoneCallback.bind(this),this.moveCanceledCallback.bind(this)),this.animationQueue=[],e.props.sprite.cache&&this.cacheSprite(),e.props.responsive&&(this.resizeListener=this.handleResize.bind(this),window.addEventListener("resize",this.resizeListener)),this.pointerDownListener=this.pointerDownHandler.bind(this),this.chessboard.element.addEventListener("mousedown",this.pointerDownListener),this.chessboard.element.addEventListener("touchstart",this.pointerDownListener),this.createSvgAndGroups(),this.updateMetrics(),t(),e.props.responsive&&setTimeout((()=>{this.handleResize()}))}pointerDownHandler(e){this.moveInput.onPointerDown(e)}destroy(){this.moveInput.destroy(),window.removeEventListener("resize",this.resizeListener),this.chessboard.element.removeEventListener("mousedown",this.pointerDownListener),this.chessboard.element.removeEventListener("touchstart",this.pointerDownListener),window.clearTimeout(this.resizeDebounce),window.clearTimeout(this.redrawDebounce),window.clearTimeout(this.drawPiecesDebounce),window.clearTimeout(this.drawMarkersDebounce),F.removeElement(this.svg),this.animationQueue=[],this.currentAnimation&&cancelAnimationFrame(this.currentAnimation.frameHandle)}cacheSprite(){const e="chessboardSpriteCache";if(!document.getElementById(e)){const t=document.createElement("div");t.style.display="none",t.id=e,document.body.appendChild(t);const i=new XMLHttpRequest;i.open("GET",this.chessboard.props.sprite.url,!0),i.onload=function(){t.insertAdjacentHTML("afterbegin",i.response)},i.send()}}createSvgAndGroups(){this.svg&&F.removeElement(this.svg),this.svg=F.createSvg(this.chessboard.element);let e=this.chessboard.props.style.cssClass?this.chessboard.props.style.cssClass:"default";this.svg.setAttribute("class","cm-chessboard border-type-"+this.chessboard.props.style.borderType+" "+e),this.updateMetrics(),this.boardGroup=F.addElement(this.svg,"g",{class:"board"}),this.coordinatesGroup=F.addElement(this.svg,"g",{class:"coordinates"}),this.markersGroup=F.addElement(this.svg,"g",{class:"markers"}),this.piecesGroup=F.addElement(this.svg,"g",{class:"pieces"})}updateMetrics(){this.width=this.chessboard.element.clientWidth,this.height=this.chessboard.element.clientHeight,this.chessboard.props.style.borderType===X.frame?this.borderSize=this.width/25:this.chessboard.props.style.borderType===X.thin?this.borderSize=this.width/320:this.borderSize=0,this.innerWidth=this.width-2*this.borderSize,this.innerHeight=this.height-2*this.borderSize,this.squareWidth=this.innerWidth/8,this.squareHeight=this.innerHeight/8,this.scalingX=this.squareWidth/this.chessboard.props.sprite.size,this.scalingY=this.squareHeight/this.chessboard.props.sprite.size,this.pieceXTranslate=this.squareWidth/2-this.chessboard.props.sprite.size*this.scalingY/2}handleResize(){window.clearTimeout(this.resizeDebounce),this.resizeDebounce=setTimeout((()=>{this.chessboard.props.style.aspectRatio&&(this.chessboard.element.style.height=this.chessboard.element.clientWidth*this.chessboard.props.style.aspectRatio+"px"),this.chessboard.element.clientWidth===this.width&&this.chessboard.element.clientHeight===this.height||(this.updateMetrics(),this.redraw()),this.svg.setAttribute("width","100%"),this.svg.setAttribute("height","100%")}))}redraw(){return new Promise((e=>{window.clearTimeout(this.redrawDebounce),this.redrawDebounce=setTimeout((()=>{this.drawBoard(),this.drawCoordinates(),this.drawMarkers(),this.setCursor()})),this.drawPiecesDebounced(this.chessboard.state.squares,(()=>{e()}))}))}drawBoard(){for(;this.boardGroup.firstChild;)this.boardGroup.removeChild(this.boardGroup.lastChild);if(this.chessboard.props.style.borderType!==X.none){if(F.addElement(this.boardGroup,"rect",{width:this.width,height:this.height}).setAttribute("class","border"),this.chessboard.props.style.borderType===X.frame){const e=this.borderSize;F.addElement(this.boardGroup,"rect",{x:e,y:e,width:this.width-2*e,height:this.height-2*e}).setAttribute("class","border-inner")}}for(let e=0;e<64;e++){const t=this.chessboard.state.orientation===K.white?e:63-e,i=`square ${0==(9*t&8)?"black":"white"}`,s=this.squareIndexToPoint(t),r=F.addElement(this.boardGroup,"rect",{x:s.x,y:s.y,width:this.squareWidth,height:this.squareHeight});r.setAttribute("class",i),r.setAttribute("data-index",""+t)}}drawCoordinates(){if(!this.chessboard.props.style.showCoordinates)return;for(;this.coordinatesGroup.firstChild;)this.coordinatesGroup.removeChild(this.coordinatesGroup.lastChild);const e=this.chessboard.props.style.borderType!==X.frame;for(let t=0;t<8;t++){let i=this.borderSize+(17+this.chessboard.props.sprite.size*t)*this.scalingX,s=this.height-3.5*this.scalingY,r="coordinate file";e&&(i+=15.5*this.scalingX,r+=t%2?" white":" black");const n=F.addElement(this.coordinatesGroup,"text",{class:r,x:i,y:s,style:`font-size: ${10*this.scalingY}px`});this.chessboard.state.orientation===K.white?n.textContent=String.fromCharCode(97+t):n.textContent=String.fromCharCode(104-t)}for(let t=0;t<8;t++){let i=this.borderSize/3.7,s=this.borderSize+25*this.scalingY+t*this.squareHeight,r="coordinate rank";e&&(r+=t%2?" black":" white",this.chessboard.props.style.borderType===X.frame?(i+=10*this.scalingX,s-=15*this.scalingY):(i+=2*this.scalingX,s-=15*this.scalingY));const n=F.addElement(this.coordinatesGroup,"text",{class:r,x:i,y:s,style:`font-size: ${10*this.scalingY}px`});this.chessboard.state.orientation===K.white?n.textContent=8-t:n.textContent=1+t}}drawPiecesDebounced(e=this.chessboard.state.squares,t){window.clearTimeout(this.drawPiecesDebounce),this.drawPiecesDebounce=setTimeout((()=>{this.drawPieces(e),t&&t()}))}drawPieces(e=this.chessboard.state.squares){for(;this.piecesGroup.firstChild;)this.piecesGroup.removeChild(this.piecesGroup.lastChild);for(let t=0;t<64;t++){const i=e[t];i&&this.drawPiece(t,i)}}drawPiece(e,t){const i=F.addElement(this.piecesGroup,"g");i.setAttribute("data-piece",t),i.setAttribute("data-index",e);const s=this.squareIndexToPoint(e),r=this.svg.createSVGTransform();r.setTranslate(s.x,s.y),i.transform.baseVal.appendItem(r);const n=this.chessboard.props.sprite.cache?"":this.chessboard.props.sprite.url,o=F.addElement(i,"use",{href:`${n}#${t}`,class:"piece"}),a=this.svg.createSVGTransform();a.setTranslate(this.pieceXTranslate,0),o.transform.baseVal.appendItem(a);const h=this.svg.createSVGTransform();return h.setScale(this.scalingY,this.scalingY),o.transform.baseVal.appendItem(h),i}setPieceVisibility(e,t=!0){const i=this.getPiece(e);t?i.setAttribute("visibility","visible"):i.setAttribute("visibility","hidden")}getPiece(e){return this.piecesGroup.querySelector(`g[data-index='${e}']`)}drawMarkersDebounced(){window.clearTimeout(this.drawMarkersDebounce),this.drawMarkersDebounce=setTimeout((()=>{this.drawMarkers()}),10)}drawMarkers(){for(;this.markersGroup.firstChild;)this.markersGroup.removeChild(this.markersGroup.firstChild);this.chessboard.state.markers.forEach((e=>{this.drawMarker(e)}))}drawMarker(e){const t=F.addElement(this.markersGroup,"g");t.setAttribute("data-index",e.index);const i=this.squareIndexToPoint(e.index),s=this.svg.createSVGTransform();s.setTranslate(i.x,i.y),t.transform.baseVal.appendItem(s);const r=this.chessboard.props.sprite.cache?"":this.chessboard.props.sprite.url,n=F.addElement(t,"use",{href:`${r}#${e.type.slice}`,class:"marker "+e.type.class}),o=this.svg.createSVGTransform();return o.setScale(this.scalingX,this.scalingY),n.transform.baseVal.appendItem(o),t}animatePieces(e,t,i){this.animationQueue.push({fromSquares:e,toSquares:t,callback:i}),this.animationRunning||this.nextPieceAnimationInQueue()}nextPieceAnimationInQueue(){const e=this.animationQueue.shift();void 0!==e&&(this.currentAnimation=new Q(this,e.fromSquares,e.toSquares,this.chessboard.props.animationDuration/(this.animationQueue.length+1),(()=>{this.moveInput.draggablePiece||this.drawPieces(e.toSquares),this.nextPieceAnimationInQueue(),e.callback&&e.callback()})))}enableMoveInput(e,t){t===K.white?this.chessboard.state.inputWhiteEnabled=!0:(t===K.black||(this.chessboard.state.inputWhiteEnabled=!0),this.chessboard.state.inputBlackEnabled=!0),this.chessboard.state.inputEnabled=!0,this.moveInputCallback=e,this.setCursor()}disableMoveInput(){this.chessboard.state.inputWhiteEnabled=!1,this.chessboard.state.inputBlackEnabled=!1,this.chessboard.state.inputEnabled=!1,this.moveInputCallback=void 0,this.setCursor()}moveStartCallback(e){return!this.moveInputCallback||this.moveInputCallback({chessboard:this.chessboard,type:W.moveStart,square:j[e]})}moveDoneCallback(e,t){return!this.moveInputCallback||this.moveInputCallback({chessboard:this.chessboard,type:W.moveDone,squareFrom:j[e],squareTo:j[t]})}moveCanceledCallback(e,t){this.moveInputCallback&&this.moveInputCallback({chessboard:this.chessboard,type:W.moveCanceled,reason:e,square:t?j[t]:void 0})}setCursor(){this.chessboard.initialization.then((()=>{this.chessboard.state.inputWhiteEnabled||this.chessboard.state.inputBlackEnabled||this.chessboard.boardClickListener?this.boardGroup.setAttribute("class","board input-enabled"):this.boardGroup.setAttribute("class","board")}))}squareIndexToPoint(e){let t,i;return this.chessboard.state.orientation===K.white?(t=this.borderSize+e%8*this.squareWidth,i=this.borderSize+(7-Math.floor(e/8))*this.squareHeight):(t=this.borderSize+(7-e%8)*this.squareWidth,i=this.borderSize+Math.floor(e/8)*this.squareHeight),{x:t,y:i}}}class F{static createSvg(e){let t=document.createElementNS("http://www.w3.org/2000/svg","svg");return e&&(t.setAttribute("width","100%"),t.setAttribute("height","100%"),e.appendChild(t)),t}static addElement(e,t,i){let s=document.createElementNS("http://www.w3.org/2000/svg",t);"use"===t&&(i["xlink:href"]=i.href);for(let r in i)if(i.hasOwnProperty(r))if(-1!==r.indexOf(":")){const e=r.split(":");s.setAttributeNS("http://www.w3.org/1999/"+e[0],e[1],i[r])}else s.setAttribute(r,i[r]);return e.appendChild(s),s}static removeElement(e){e.parentNode.removeChild(e)}}class H{constructor(){this.squares=new Array(64).fill(void 0),this.orientation=void 0,this.markers=[]}setPiece(e,t){this.squares[e]=t}addMarker(e,t){this.markers.push({index:e,type:t})}removeMarkers(e,t){this.markers=e||t?this.markers.filter((i=>{if(i.type){if(e){if(i.type===t&&e===i.index)return!1}else if(i.type===t)return!1}else if(e===i.index)return!1;return!0})):[]}setPosition(e){if(e){const t=e.replace(/^\s*/,"").replace(/\s*$/,"").split(/\/|\s/);for(let e=0;e<8;e++){const i=t[7-e].replace(/\d/g,(e=>{const t=parseInt(e);let i="";for(let s=0;s<t;s++)i+="-";return i}));for(let t=0;t<8;t++){const s=i.substr(t,1);let r;"-"!==s&&(r=s.toUpperCase()===s?`w${s.toLowerCase()}`:`b${s}`),this.squares[8*e+t]=r}}}}getPosition(){let e=new Array(8).fill("");for(let t=0;t<8;t++){let i=0;for(let s=0;s<8;s++){const r=this.squares[8*t+s];if(void 0===r)i++;else{i>0&&(e[7-t]+=i,i=0);const s=r.substr(0,1),n=r.substr(1,1);e[7-t]+="w"===s?n.toUpperCase():n}}i>0&&(e[7-t]+=i,i=0)}return e.join("/")}squareToIndex(e){const t=e.substr(0,1).charCodeAt(0)-97;return 8*(e.substr(1,1)-1)+t}}const K={white:"w",black:"b"},W={moveStart:"moveStart",moveDone:"moveDone",moveCanceled:"moveCanceled"},V="primary",Y="secondary",X={none:"none",thin:"thin",frame:"frame"},J={move:{class:"move",slice:"markerFrame"},emphasize:{class:"emphasize",slice:"markerSquare"},danger:{class:"danger",slice:"markerCircle"}},Z="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class ee{constructor(e,t={}){if(!e)throw new Error("container element is "+e);this.element=e;let i={position:"empty",orientation:K.white,style:{cssClass:"default",showCoordinates:!0,borderType:X.thin,aspectRatio:1},responsive:!0,animationDuration:300,sprite:{url:"./assets/images/chessboard-sprite-staunty.svg",size:40,cache:!0}};t.style&&void 0!==t.style.showBorder&&(console.warn("style.showBorder is deprecated, use style.borderType instead"),t.style.showBorder?t.style.borderType=X.frame:t.style.borderType=X.thin),t.moveInputMode&&console.warn("`props.moveInputMode` is deprecated, you don't need it anymore"),this.props={},Object.assign(this.props,i),Object.assign(this.props,t),this.props.sprite=i.sprite,this.props.style=i.style,t.sprite&&Object.assign(this.props.sprite,t.sprite),t.style&&Object.assign(this.props.style,t.style),this.props.style.aspectRatio&&(this.element.style.height=this.element.offsetWidth*this.props.style.aspectRatio+"px"),this.state=new H,this.state.orientation=this.props.orientation,this.initialization=new Promise((e=>{this.view=new B(this,(()=>{"start"===this.props.position?this.state.setPosition(Z):"empty"===this.props.position||void 0===this.props.position?this.state.setPosition("8/8/8/8/8/8/8/8"):this.state.setPosition(this.props.position),setTimeout((()=>{this.view.redraw().then((()=>{e()}))}))}))}))}setPiece(e,t){return new Promise((i=>{this.initialization.then((()=>{this.state.setPiece(this.state.squareToIndex(e),t),this.view.drawPiecesDebounced(this.state.squares,(()=>{i()}))}))}))}getPiece(e){return this.state.squares[this.state.squareToIndex(e)]}setPosition(e,t=!0){return new Promise((i=>{this.initialization.then((()=>{const s=this.state.getPosition();if(e.split(" ")[0]!==s){const s=this.state.squares.slice(0);"start"===e?this.state.setPosition(Z):"empty"===e||void 0===e?this.state.setPosition("8/8/8/8/8/8/8/8"):this.state.setPosition(e),t?this.view.animatePieces(s,this.state.squares.slice(0),(()=>{i()})):(this.view.drawPiecesDebounced(),i())}else i()}))}))}getPosition(){return this.state.getPosition()}addMarker(e,t=J.emphasize){this.state.addMarker(this.state.squareToIndex(e),t),this.view.drawMarkersDebounced()}getMarkers(e,t){const i=[];return this.state.markers.forEach((s=>{const r=j[s.index];(!e&&(!t||t===s.type)||!t&&e===r||t===s.type&&e===r)&&i.push({square:j[s.index],type:s.type})})),i}removeMarkers(e,t){const i=e?this.state.squareToIndex(e):void 0;this.state.removeMarkers(i,t),this.view.drawMarkersDebounced()}setOrientation(e){this.state.orientation=e,this.view.redraw()}getOrientation(){return this.state.orientation}destroy(){return new Promise((e=>{this.initialization.then((()=>{this.view.destroy(),this.view=void 0,this.state=void 0,this.element.removeEventListener("contextmenu",this.contextMenuListener),e()}))}))}enableMoveInput(e,t){this.view.enableMoveInput(e,t)}disableMoveInput(){this.view.disableMoveInput()}enableContextInput(e){console.warn("enableContextInput is deprecated, use enableSquareSelect"),this.enableSquareSelect((function(t){t.type===Y&&e(t)}))}disableContextInput(){this.disableSquareSelect()}enableSquareSelect(e){this.squareSelectListener?console.warn("squareSelectListener already existing"):(this.squareSelectListener=function(t){const i=t.target.getAttribute("data-index");"contextmenu"!==t.type?e({chessboard:this,type:2===t.button?Y:V,square:j[i]}):t.preventDefault()},this.element.addEventListener("contextmenu",this.squareSelectListener),this.element.addEventListener("mouseup",this.squareSelectListener),this.element.addEventListener("touchend",this.squareSelectListener))}disableSquareSelect(){this.element.removeEventListener("contextmenu",this.squareSelectListener),this.element.removeEventListener("mouseup",this.squareSelectListener),this.element.removeEventListener("touchend",this.squareSelectListener),this.squareSelectListener=void 0}}var te,ie=(function(e,t){t.Chess=function(e){var t="b",i="w",s=-1,r="p",n="b",o="k",a="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1",h=["1-0","0-1","1/2-1/2","*"],c={b:[16,32,17,15],w:[-16,-32,-17,-15]},l={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},d=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],u=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],p={p:0,n:1,b:2,r:3,q:4,k:5},f={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},m={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},v={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},b={w:[{square:v.a1,flag:m.QSIDE_CASTLE},{square:v.h1,flag:m.KSIDE_CASTLE}],b:[{square:v.a8,flag:m.QSIDE_CASTLE},{square:v.h8,flag:m.KSIDE_CASTLE}]},g=new Array(128),w={w:s,b:s},y=i,I={w:0,b:0},S=s,E=0,k=1,P=[],x={},C={};function T(e){void 0===e&&(e=!1),g=new Array(128),w={w:s,b:s},y=i,I={w:0,b:0},S=s,E=0,k=1,P=[],e||(x={}),C={},R(M())}function A(){for(var e=[],t={},i=function(e){e in C&&(t[e]=C[e])};P.length>0;)e.push(Y());for(i(M());e.length>0;)V(e.pop()),i(M());C=t}function q(){L(a)}function L(e,r){void 0===r&&(r=!1);var n=e.split(/\s+/),o=n[0],a=0;if(!_(e).valid)return!1;T(r);for(var h=0;h<o.length;h++){var c=o.charAt(h);if("/"===c)a+=8;else if(-1!=="0123456789".indexOf(c))a+=parseInt(c,10);else{var l=c<"a"?i:t;G({type:c.toLowerCase(),color:l},ee(a)),a++}}return y=n[1],n[2].indexOf("K")>-1&&(I.w|=m.KSIDE_CASTLE),n[2].indexOf("Q")>-1&&(I.w|=m.QSIDE_CASTLE),n[2].indexOf("k")>-1&&(I.b|=m.KSIDE_CASTLE),n[2].indexOf("q")>-1&&(I.b|=m.QSIDE_CASTLE),S="-"===n[3]?s:v[n[3]],E=parseInt(n[4],10),k=parseInt(n[5],10),R(M()),!0}function _(e){var t="No errors.",i="FEN string must contain six space-delimited fields.",s="6th field (move number) must be a positive integer.",r="5th field (half move counter) must be a non-negative integer.",n="4th field (en-passant square) is invalid.",o="3rd field (castling availability) is invalid.",a="2nd field (side to move) is invalid.",h="1st field (piece positions) does not contain 8 '/'-delimited rows.",c="1st field (piece positions) is invalid [consecutive numbers].",l="1st field (piece positions) is invalid [invalid piece].",d="1st field (piece positions) is invalid [row too large].",u="Illegal en-passant square",p=e.split(/\s+/);if(6!==p.length)return{valid:!1,error_number:1,error:i};if(isNaN(p[5])||parseInt(p[5],10)<=0)return{valid:!1,error_number:2,error:s};if(isNaN(p[4])||parseInt(p[4],10)<0)return{valid:!1,error_number:3,error:r};if(!/^(-|[abcdefgh][36])$/.test(p[3]))return{valid:!1,error_number:4,error:n};if(!/^(KQ?k?q?|Qk?q?|kq?|q|-)$/.test(p[2]))return{valid:!1,error_number:5,error:o};if(!/^(w|b)$/.test(p[1]))return{valid:!1,error_number:6,error:a};var f=p[0].split("/");if(8!==f.length)return{valid:!1,error_number:7,error:h};for(var m=0;m<f.length;m++){for(var v=0,b=!1,g=0;g<f[m].length;g++)if(isNaN(f[m][g])){if(!/^[prnbqkPRNBQK]$/.test(f[m][g]))return{valid:!1,error_number:9,error:l};v+=1,b=!1}else{if(b)return{valid:!1,error_number:8,error:c};v+=parseInt(f[m][g],10),b=!0}if(8!==v)return{valid:!1,error_number:10,error:d}}return"3"==p[3][1]&&"w"==p[1]||"6"==p[3][1]&&"b"==p[1]?{valid:!1,error_number:11,error:u}:{valid:!0,error_number:0,error:t}}function M(){for(var e=0,t="",r=v.a8;r<=v.h1;r++){if(null==g[r])e++;else{e>0&&(t+=e,e=0);var n=g[r].color,o=g[r].type;t+=n===i?o.toUpperCase():o.toLowerCase()}r+1&136&&(e>0&&(t+=e),r!==v.h1&&(t+="/"),e=0,r+=8)}var a="";I.w&m.KSIDE_CASTLE&&(a+="K"),I.w&m.QSIDE_CASTLE&&(a+="Q"),I.b&m.KSIDE_CASTLE&&(a+="k"),I.b&m.QSIDE_CASTLE&&(a+="q"),a=a||"-";var h=S===s?"-":ee(S);return[t,y,a,h,E,k].join(" ")}function D(e){for(var t=0;t<e.length;t+=2)"string"==typeof e[t]&&"string"==typeof e[t+1]&&(x[e[t]]=e[t+1]);return x}function R(e){P.length>0||(e!==a?(x.SetUp="1",x.FEN=e):(delete x.SetUp,delete x.FEN))}function O(e){var t=g[v[e]];return t?{type:t.type,color:t.color}:null}function G(e,t){if(!("type"in e)||!("color"in e))return!1;if(-1==="pnbrqkPNBRQK".indexOf(e.type.toLowerCase()))return!1;if(!(t in v))return!1;var i=v[t];return(e.type!=o||w[e.color]==s||w[e.color]==i)&&(g[i]={type:e.type,color:e.color},e.type===o&&(w[e.color]=i),R(M()),!0)}function $(e,t,i,s,n){var o={color:y,from:t,to:i,flags:s,piece:e[t].type};return n&&(o.flags|=m.PROMOTION,o.promotion=n),e[i]?o.captured=e[i].type:s&m.EP_CAPTURE&&(o.captured=r),o}function N(e){function t(e,t,i,s,o){if(e[i].type!==r||0!==J(s)&&7!==J(s))t.push($(e,i,s,o));else for(var a=["q","r",n,"n"],h=0,c=a.length;h<c;h++)t.push($(e,i,s,o,a[h]))}var i=[],s=y,o=te(s),a={b:1,w:6},h=v.a8,d=v.h1,u=!1,p=void 0===e||!("legal"in e)||e.legal;if(void 0!==e&&"square"in e){if(!(e.square in v))return[];h=d=v[e.square],u=!0}for(var f=h;f<=d;f++)if(136&f)f+=7;else{var b=g[f];if(null!=b&&b.color===s)if(b.type===r){var E=f+c[s][0];for(null==g[E]&&(t(g,i,f,E,m.NORMAL),E=f+c[s][1],a[s]===J(f)&&null==g[E]&&t(g,i,f,E,m.BIG_PAWN)),k=2;k<4;k++)136&(E=f+c[s][k])||(null!=g[E]&&g[E].color===o?t(g,i,f,E,m.CAPTURE):E===S&&t(g,i,f,S,m.EP_CAPTURE))}else for(var k=0,P=l[b.type].length;k<P;k++){var x=l[b.type][k];for(E=f;!(136&(E+=x));){if(null!=g[E]){if(g[E].color===s)break;t(g,i,f,E,m.CAPTURE);break}if(t(g,i,f,E,m.NORMAL),"n"===b.type||"k"===b.type)break}}}if(!u||d===w[s]){if(I[s]&m.KSIDE_CASTLE){var C=(T=w[s])+2;null!=g[T+1]||null!=g[C]||Q(o,w[s])||Q(o,T+1)||Q(o,C)||t(g,i,w[s],C,m.KSIDE_CASTLE)}var T;if(I[s]&m.QSIDE_CASTLE)C=(T=w[s])-2,null!=g[T-1]||null!=g[T-2]||null!=g[T-3]||Q(o,w[s])||Q(o,T-1)||Q(o,C)||t(g,i,w[s],C,m.QSIDE_CASTLE)}if(!p)return i;var A=[];for(f=0,P=i.length;f<P;f++)V(i[f]),j(s)||A.push(i[f]),Y();return A}function U(e,t){var i="";if(e.flags&m.KSIDE_CASTLE)i="O-O";else if(e.flags&m.QSIDE_CASTLE)i="O-O-O";else{var s=function(e,t){for(var i=N({legal:!t}),s=e.from,r=e.to,n=e.piece,o=0,a=0,h=0,c=0,l=i.length;c<l;c++){var d=i[c].from,u=i[c].to;n===i[c].piece&&s!==d&&r===u&&(o++,J(s)===J(d)&&a++,Z(s)===Z(d)&&h++)}return o>0?a>0&&h>0?ee(s):h>0?ee(s).charAt(1):ee(s).charAt(0):""}(e,t);e.piece!==r&&(i+=e.piece.toUpperCase()+s),e.flags&(m.CAPTURE|m.EP_CAPTURE)&&(e.piece===r&&(i+=ee(e.from)[0]),i+="x"),i+=ee(e.to),e.flags&m.PROMOTION&&(i+="="+e.promotion.toUpperCase())}return V(e),B()&&(F()?i+="#":i+="+"),Y(),i}function z(e){return e.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function Q(e,s){for(var n=v.a8;n<=v.h1;n++)if(136&n)n+=7;else if(null!=g[n]&&g[n].color===e){var o=g[n],a=n-s,h=a+119;if(d[h]&1<<p[o.type]){if(o.type===r){if(a>0){if(o.color===i)return!0}else if(o.color===t)return!0;continue}if("n"===o.type||"k"===o.type)return!0;for(var c=u[h],l=n+c,f=!1;l!==s;){if(null!=g[l]){f=!0;break}l+=c}if(!f)return!0}}return!1}function j(e){return Q(te(e),w[e])}function B(){return j(y)}function F(){return B()&&0===N().length}function H(){return!B()&&0===N().length}function K(){for(var e={},t=[],i=0,s=0,r=v.a8;r<=v.h1;r++)if(s=(s+1)%2,136&r)r+=7;else{var o=g[r];o&&(e[o.type]=o.type in e?e[o.type]+1:1,o.type===n&&t.push(s),i++)}if(2===i)return!0;if(3===i&&(1===e.b||1===e.n))return!0;if(i===e.b+2){var a=0,h=t.length;for(r=0;r<h;r++)a+=t[r];if(0===a||a===h)return!0}return!1}function W(){for(var e=[],t={},i=!1;;){var s=Y();if(!s)break;e.push(s)}for(;;){var r=M().split(" ").slice(0,4).join(" ");if(t[r]=r in t?t[r]+1:1,t[r]>=3&&(i=!0),!e.length)break;V(e.pop())}return i}function V(e){var i=y,n=te(i);if(function(e){P.push({move:e,kings:{b:w.b,w:w.w},turn:y,castling:{b:I.b,w:I.w},ep_square:S,half_moves:E,move_number:k})}(e),g[e.to]=g[e.from],g[e.from]=null,e.flags&m.EP_CAPTURE&&(y===t?g[e.to-16]=null:g[e.to+16]=null),e.flags&m.PROMOTION&&(g[e.to]={type:e.promotion,color:i}),g[e.to].type===o){if(w[g[e.to].color]=e.to,e.flags&m.KSIDE_CASTLE){var a=e.to-1,h=e.to+1;g[a]=g[h],g[h]=null}else e.flags&m.QSIDE_CASTLE&&(a=e.to+1,h=e.to-2,g[a]=g[h],g[h]=null);I[i]=""}if(I[i])for(var c=0,l=b[i].length;c<l;c++)if(e.from===b[i][c].square&&I[i]&b[i][c].flag){I[i]^=b[i][c].flag;break}if(I[n])for(c=0,l=b[n].length;c<l;c++)if(e.to===b[n][c].square&&I[n]&b[n][c].flag){I[n]^=b[n][c].flag;break}S=e.flags&m.BIG_PAWN?"b"===y?e.to-16:e.to+16:s,e.piece===r||e.flags&(m.CAPTURE|m.EP_CAPTURE)?E=0:E++,y===t&&k++,y=te(y)}function Y(){var e=P.pop();if(null==e)return null;var i=e.move;w=e.kings,y=e.turn,I=e.castling,S=e.ep_square,E=e.half_moves,k=e.move_number;var s,n,o=y,a=te(y);if(g[i.from]=g[i.to],g[i.from].type=i.piece,g[i.to]=null,i.flags&m.CAPTURE)g[i.to]={type:i.captured,color:a};else if(i.flags&m.EP_CAPTURE){var h;h=o===t?i.to-16:i.to+16,g[h]={type:r,color:a}}return i.flags&(m.KSIDE_CASTLE|m.QSIDE_CASTLE)&&(i.flags&m.KSIDE_CASTLE?(s=i.to+1,n=i.to-1):i.flags&m.QSIDE_CASTLE&&(s=i.to-2,n=i.to+1),g[s]=g[n],g[n]=null),i}function X(e,t){var i=z(e);if(t){var s=i.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/);if(s)var r=s[1],n=s[2],o=s[3],a=s[4]}for(var h=N(),c=0,l=h.length;c<l;c++){if(i===z(U(h[c]))||t&&i===z(U(h[c],!0)))return h[c];if(s&&(!r||r.toLowerCase()==h[c].piece)&&v[n]==h[c].from&&v[o]==h[c].to&&(!a||a.toLowerCase()==h[c].promotion))return h[c]}return null}function J(e){return e>>4}function Z(e){return 15&e}function ee(e){var t=Z(e),i=J(e);return"abcdefgh".substring(t,t+1)+"87654321".substring(i,i+1)}function te(e){return e===i?t:i}function ie(e){var t=se(e);t.san=U(t,!1),t.to=ee(t.to),t.from=ee(t.from);var i="";for(var s in m)m[s]&t.flags&&(i+=f[s]);return t.flags=i,t}function se(e){var t=e instanceof Array?[]:{};for(var i in e)t[i]="object"==typeof i?se(e[i]):e[i];return t}function re(e){return e.replace(/^\s+|\s+$/g,"")}function ne(e){for(var t=N({legal:!1}),i=0,s=y,r=0,n=t.length;r<n;r++)V(t[r]),j(s)||(e-1>0?i+=ne(e-1):i++),Y();return i}return L(void 0===e?a:e),{WHITE:i,BLACK:t,PAWN:r,KNIGHT:"n",BISHOP:n,ROOK:"r",QUEEN:"q",KING:o,SQUARES:function(){for(var e=[],t=v.a8;t<=v.h1;t++)136&t?t+=7:e.push(ee(t));return e}(),FLAGS:f,load:function(e){return L(e)},reset:function(){return q()},moves:function(e){for(var t=N(e),i=[],s=0,r=t.length;s<r;s++)void 0!==e&&"verbose"in e&&e.verbose?i.push(ie(t[s])):i.push(U(t[s],!1));return i},in_check:function(){return B()},in_checkmate:function(){return F()},in_stalemate:function(){return H()},in_draw:function(){return E>=100||H()||K()||W()},insufficient_material:function(){return K()},in_threefold_repetition:function(){return W()},game_over:function(){return E>=100||F()||H()||K()||W()},validate_fen:function(e){return _(e)},fen:function(){return M()},board:function(){for(var e=[],t=[],i=v.a8;i<=v.h1;i++)null==g[i]?t.push(null):t.push({type:g[i].type,color:g[i].color}),i+1&136&&(e.push(t),t=[],i+=8);return e},pgn:function(e){var t="object"==typeof e&&"string"==typeof e.newline_char?e.newline_char:"\n",i="object"==typeof e&&"number"==typeof e.max_width?e.max_width:0,s=[],r=!1;for(var n in x)s.push("["+n+' "'+x[n]+'"]'+t),r=!0;r&&P.length&&s.push(t);for(var o=function(e){var t=C[M()];return void 0!==t&&(e=`${e}${e.length>0?" ":""}{${t}}`),e},a=[];P.length>0;)a.push(Y());var h=[],c="";for(0===a.length&&h.push(o(""));a.length>0;){c=o(c);var l=a.pop();P.length||"b"!==l.color?"w"===l.color&&(c.length&&h.push(c),c=k+"."):c=k+". ...",c=c+" "+U(l,!1),V(l)}if(c.length&&h.push(o(c)),void 0!==x.Result&&h.push(x.Result),0===i)return s.join("")+h.join(" ");var d=function(){return s.length>0&&" "===s[s.length-1]&&(s.pop(),!0)},u=function(e,r){for(var n of r.split(" "))if(n){if(e+n.length>i){for(;d();)e--;s.push(t),e=0}s.push(n),e+=n.length,s.push(" "),e++}return d()&&e--,e},p=0;for(n=0;n<h.length;n++)p+h[n].length>i&&h[n].includes("{")?p=u(p,h[n]):(p+h[n].length>i&&0!==n?(" "===s[s.length-1]&&s.pop(),s.push(t),p=0):0!==n&&(s.push(" "),p++),s.push(h[n]),p+=h[n].length);return s.join("")},load_pgn:function(e,t){var i=void 0!==t&&"sloppy"in t&&t.sloppy;function s(e){return e.replace(/\\/g,"\\")}var r="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",n=new RegExp("^(\\[((?:"+s(r)+")|.)*\\])(?:"+s(r)+"){2}"),o=n.test(e)?n.exec(e)[1]:"";q();var a=function(e,t){for(var i="object"==typeof t&&"string"==typeof t.newline_char?t.newline_char:"\r?\n",r={},n=e.split(new RegExp(s(i))),o="",a="",h=0;h<n.length;h++)o=n[h].replace(/^\[([A-Z][A-Za-z]*)\s.*\]$/,"$1"),a=n[h].replace(/^\[[A-Za-z]+\s"(.*)"\ *\]$/,"$1"),re(o).length>0&&(r[o]=a);return r}(o,t);for(var c in a)D([c,a[c]]);if(!("1"!==a.SetUp||"FEN"in a&&L(a.FEN,!0)))return!1;for(var l=function(e){return`{${function(e){return Array.from(e).map((function(e){return e.charCodeAt(0)<128?e.charCodeAt(0).toString(16):encodeURIComponent(e).replace(/\%/g,"").toLowerCase()})).join("")}((e=e.replace(new RegExp(s(r),"g")," ")).slice(1,e.length-1))}}`},d=function(e){if(e.startsWith("{")&&e.endsWith("}"))return function(e){return 0==e.length?"":decodeURIComponent("%"+e.match(/.{1,2}/g).join("%"))}(e.slice(1,e.length-1))},u=e.replace(o,"").replace(new RegExp(`({[^}]*})+?|;([^${s(r)}]*)`,"g"),(function(e,t,i){return void 0!==t?l(t):" "+l(`{${i.slice(1)}}`)})).replace(new RegExp(s(r),"g")," "),p=/(\([^\(\)]+\))+?/g;p.test(u);)u=u.replace(p,"");var f=re(u=(u=(u=u.replace(/\d+\.(\.\.)?/g,"")).replace(/\.\.\./g,"")).replace(/\$\d+/g,"")).split(new RegExp(/\s+/));f=f.join(",").replace(/,,+/g,",").split(",");for(var m="",v=0;v<f.length-1;v++){var b=d(f[v]);if(void 0===b){if(null==(m=X(f[v],i)))return!1;V(m)}else C[M()]=b}if(void 0!==(b=d(f[f.length-1]))&&(C[M()]=b,f.pop()),m=f[f.length-1],h.indexOf(m)>-1)(function(e){for(var t in e)return!0;return!1})(x)&&void 0===x.Result&&D(["Result",m]);else{if(null==(m=X(m,i)))return!1;V(m)}return!0},header:function(){return D(arguments)},ascii:function(){return function(){for(var e="   +------------------------+\n",t=v.a8;t<=v.h1;t++){if(0===Z(t)&&(e+=" "+"87654321"[J(t)]+" |"),null==g[t])e+=" . ";else{var s=g[t].type;e+=" "+(g[t].color===i?s.toUpperCase():s.toLowerCase())+" "}t+1&136&&(e+="|\n",t+=8)}return(e+="   +------------------------+\n")+"     a  b  c  d  e  f  g  h\n"}()},turn:function(){return y},move:function(e,t){var i=void 0!==t&&"sloppy"in t&&t.sloppy,s=null;if("string"==typeof e)s=X(e,i);else if("object"==typeof e)for(var r=N(),n=0,o=r.length;n<o;n++)if(e.from===ee(r[n].from)&&e.to===ee(r[n].to)&&(!("promotion"in r[n])||e.promotion===r[n].promotion)){s=r[n];break}if(!s)return null;var a=ie(s);return V(s),a},undo:function(){var e=Y();return e?ie(e):null},clear:function(){return T()},put:function(e,t){return G(e,t)},get:function(e){return O(e)},remove:function(e){return function(e){var t=O(e);return g[v[e]]=null,t&&t.type===o&&(w[t.color]=s),R(M()),t}(e)},perft:function(e){return ne(e)},square_color:function(e){if(e in v){var t=v[e];return(J(t)+Z(t))%2==0?"light":"dark"}return null},history:function(e){for(var t=[],i=[],s=(void 0!==e&&"verbose"in e&&e.verbose);P.length>0;)t.push(Y());for(;t.length>0;){var r=t.pop();s?i.push(ie(r)):i.push(U(r)),V(r)}return i},get_comment:function(){return C[M()]},set_comment:function(e){C[M()]=e.replace("{","[").replace("}","]")},delete_comment:function(){var e=C[M()];return delete C[M()],e},get_comments:function(){return A(),Object.keys(C).map((function(e){return{fen:e,comment:C[e]}}))},delete_comments:function(){return A(),Object.keys(C).map((function(e){var t=C[e];return delete C[e],{fen:e,comment:t}}))}}}}(te={exports:{}},te.exports),te.exports);function se(e){let t,i,m,v,b,g,w,y,I,S,E,k;return{c(){t=s("p"),i=r("In check:"),m=r(e[0]),v=n(),b=s("p"),g=r("In checkmate:"),w=r(e[1]),y=n(),I=s("p"),S=r(e[3]),E=n(),k=s("div")},l(s){t=o(s,"P",{});var r=a(t);i=h(r,"In check:"),m=h(r,e[0]),r.forEach(c),v=l(s),b=o(s,"P",{});var n=a(b);g=h(n,"In checkmate:"),w=h(n,e[1]),n.forEach(c),y=l(s),I=o(s,"P",{});var d=a(I);S=h(d,e[3]),d.forEach(c),E=l(s),k=o(s,"DIV",{}),a(k).forEach(c)},m(s,r){d(s,t,r),u(t,i),u(t,m),d(s,v,r),d(s,b,r),u(b,g),u(b,w),d(s,y,r),d(s,I,r),u(I,S),d(s,E,r),d(s,k,r),e[7](k)},p(e,[t]){1&t&&p(m,e[0]),2&t&&p(w,e[1]),8&t&&p(S,e[3])},i:f,o:f,d(i){i&&c(t),i&&c(v),i&&c(b),i&&c(y),i&&c(I),i&&c(E),i&&c(k),e[7](null)}}}function re(e,t,i){let s,r;m(e,q,(e=>i(10,s=e))),m(e,L,(e=>i(11,r=e)));let n,o,a,h,c,l,{playingFirst:d}=t,{fen:u}=t,{myturn:p=!0}=t;function f(e){if(e.type===W.moveDone){const t={from:e.squareFrom,to:e.squareTo},i=n.move(t);return i&&p?(b(q,s=t,s),b(L,r=n.fen(),r)):p?console.warn("invalid move",t):e.chessboard.disableMoveInput(),i}return!0}return v((async()=>{await c.destroy(),b(L,r="",r),b(q,s="",s)})),g((async()=>{n=new ie.Chess(u),c.setPosition(n.fen()),i(0,o=n.in_check()),i(1,a=n.in_checkmate()),!1===d&&c.setOrientation(K.black),p?(1==n.in_checkmate()?i(3,l="Game is finished :you lost 🥺"):1==n.in_stalemate()?i(3,l="Game is finished :It's a tie 👔"):i(3,l="Game in Progress 🔥"),c.enableMoveInput(f)):(1==n.in_checkmate()?i(3,l="Game is finished :you Win 😎"):1==n.in_stalemate()?(console.log(n.in_stalemate()),i(3,l="Game is finished :It's a tie 👔")):i(3,l="Game in Progress 🔥"),c.disableMoveInput(f))})),w((async()=>{(()=>{const e=document.createElement("div");e.id="board1",e.style="width: 400px",h.appendChild(e),c=new ee(document.getElementById("board1"),{position:"start",sprite:{url:"../../../static/assets/images/chessboard-sprite-staunty.svg"},orientation:K.white})})()})),e.$$set=e=>{"playingFirst"in e&&i(4,d=e.playingFirst),"fen"in e&&i(5,u=e.fen),"myturn"in e&&i(6,p=e.myturn)},[o,a,h,l,d,u,p,function(e){y[e?"unshift":"push"]((()=>{h=e,i(2,h)}))}]}class ne extends e{constructor(e){super(),t(this,e,re,se,i,{playingFirst:4,fen:5,myturn:6})}}function oe(e){let t,i,n;return{c(){t=s("h3"),i=r(e[1]),n=r("'s turn")},l(s){t=o(s,"H3",{});var r=a(t);i=h(r,e[1]),n=h(r,"'s turn"),r.forEach(c)},m(e,s){d(e,t,s),u(t,i),u(t,n)},p(e,t){2&t&&p(i,e[1])},d(e){e&&c(t)}}}function ae(e){let t,i;return{c(){t=s("h3"),i=r("You're turn")},l(e){t=o(e,"H3",{});var s=a(t);i=h(s,"You're turn"),s.forEach(c)},m(e,s){d(e,t,s),u(t,i)},p:f,d(e){e&&c(t)}}}function he(e){let t,i;return t=new ne({props:{playingFirst:e[2],fen:e[5],myturn:e[0]}}),{c(){I(t.$$.fragment)},l(e){S(t.$$.fragment,e)},m(e,s){E(t,e,s),i=!0},p(e,i){const s={};4&i&&(s.playingFirst=e[2]),32&i&&(s.fen=e[5]),1&i&&(s.myturn=e[0]),t.$set(s)},i(e){i||(k(t.$$.fragment,e),i=!0)},o(e){P(t.$$.fragment,e),i=!1},d(e){x(t,e)}}}function ce(e){let t,i,f,m,v,b,g;function w(e,t){return 1==e[0]?ae:oe}let y=w(e),I=y(e),S="chess"==e[3]&&he(e);return{c(){t=s("h1"),i=r("match_id is:"),f=r(e[4]),m=n(),I.c(),v=n(),S&&S.c(),b=C()},l(s){t=o(s,"H1",{});var r=a(t);i=h(r,"match_id is:"),f=h(r,e[4]),r.forEach(c),m=l(s),I.l(s),v=l(s),S&&S.l(s),b=C()},m(e,s){d(e,t,s),u(t,i),u(t,f),d(e,m,s),I.m(e,s),d(e,v,s),S&&S.m(e,s),d(e,b,s),g=!0},p(e,[t]){(!g||16&t)&&p(f,e[4]),y===(y=w(e))&&I?I.p(e,t):(I.d(1),I=y(e),I&&(I.c(),I.m(v.parentNode,v))),"chess"==e[3]?S?(S.p(e,t),8&t&&k(S,1)):(S=he(e),S.c(),k(S,1),S.m(b.parentNode,b)):S&&(A(),P(S,1,1,(()=>{S=null})),T())},i(e){g||(k(S),g=!0)},o(e){P(S),g=!1},d(e){e&&c(t),e&&c(m),I.d(e),e&&c(v),S&&S.d(e),e&&c(b)}}}function le(e,t,i){let s,r,n,o;m(e,_,(e=>i(4,s=e))),m(e,M,(e=>i(8,r=e))),m(e,L,(e=>i(5,n=e))),m(e,q,(e=>i(7,o=e)));let a,h,c,l=!0;let d;return w((async()=>{await(async()=>{try{const e=await fetch("http://localhost:5002/game/get-match-data",{method:"POST",headers:{"Content-Type":"application/json",token:localStorage.getItem("token")},body:JSON.stringify({match_id:s})}),t=await e.json();if("string"==typeof t)throw t;i(3,c=t.game_type),i(2,h=r.user_email==t.player1_email),r.user_email==t.player1_email?i(1,a=t.player2_email):i(1,a=t.player1_email),b(L,n=t.fen,n),t.cur_player==r.user_email?i(0,l=!0):i(0,l=!1)}catch(e){displayError=e}})()})),v((async()=>{b(_,s="",s),clearInterval(d)})),e.$$.update=()=>{65&e.$$.dirty&&(0==l?i(6,d=setInterval((()=>(async()=>{try{const e=await fetch("http://localhost:5002/game/my-turn",{method:"POST",headers:{"Content-Type":"application/json",token:localStorage.getItem("token")},body:JSON.stringify({match_id:s})}),t=await e.json();if("string"==typeof t)throw t;t.success&&(i(0,l=!0),b(L,n=t.match.fen,n))}catch(e){displayError=e}})()),1e3)):1==l&&clearInterval(d)),128&e.$$.dirty&&""!=o&&(async()=>{try{const e=await fetch("http://localhost:5002/game/make-move",{method:"POST",headers:{"Content-Type":"application/json",token:localStorage.getItem("token")},body:JSON.stringify({match_id:s,move:o,fen:n})}),t=await e.json();if("string"==typeof t)throw t;i(0,l=!1),b(L,n=t.fen,n)}catch(e){displayError=e}})()},[l,a,h,c,s,n,d,o]}export default class extends e{constructor(e){super(),t(this,e,le,ce,i,{})}}
